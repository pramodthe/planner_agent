type: "openagents.agents.collaborator_agent.CollaboratorAgent"
agent_id: "flight-agent"

config:
  model_name: "gpt-5-nano-2025-08-07"
  max_iterations: 6

  tools:
    - name: "search_flights_serpapi"
      description: "Search flights using Google Flights via SerpApi."
      implementation: "tools.flight_search.search_flights_serpapi"

  instruction: |
    You are the FLIGHT AGENT.
    Your job: return at least 3 distinct flight options with prices and booking links.

    Tooling:
    - Use the Python tool: search_flights_serpapi

    Output contract (MANDATORY):
    - Provide >= 3 options in results.options (or fewer only if none exist; explain why)
    - Each option MUST include: price_total, airline, depart_time, arrive_time, duration, stops, booking_link, source
    - Also compute from the returned set:
      - cheapest_option (min price_total)
      - most_expensive_option (max price_total)
      - best_value_option (your recommendation + brief rationale)

    Do NOT talk to the user directly. Always send results to travel-coordinator via event task.complete.

  react_to_all_messages: false

  triggers:
    - event: "project.notification.message_received"
      instruction: |
        Ignore chat. Wait for task events.
        finish()

    - event: "search.flights"
      instruction: |
        Extract from payload:
          - task_id (required)
          - origin, destination, departure_date, return_date (optional)
          - travelers (default 1)
          - budget_preference (budget|luxury|unspecified)

        Call Tool:
          - search_flights_serpapi(origin=origin, destination=destination, departure_date=depart_date, return_date=return_date, travelers=travelers)
          - preference:
              if budget_preference == "budget" -> "cheapest"
              if budget_preference == "luxury" -> "best_value" (still return premium-looking options if present)
              else -> "best_value"
          - max_results: 10

        From returned options:
          - select at least 3 distinct options (vary by airline/time/stops if possible)
          - compute cheapest and most expensive from the set you are returning

        Send:
          send_event(event_name="task.complete", destination_id="travel-coordinator", payload={
            "task_id": task_id,
            "results": {
              "status": "success",
              "currency": "<currency>",
              "options": [ ...minimum 3... ],
              "cheapest_option": { ... },
              "most_expensive_option": { ... },
              "best_value_option": { ... },
              "disclaimer": "Prices are a snapshot and may change at booking."
            }
          })

        finish()

mods:
  - name: "openagents.mods.workspace.project"
    enabled: true
  - name: "openagents.mods.workspace.default"
    enabled: true
  - name: "openagents.mods.workspace.messaging"
    enabled: true

connection:
  host: "localhost"
  port: 8700
  agent_group: "booking_agents"
  password_hash: "travel123"
  encryption_enabled: false
  transport: "grpc"
  retry_attempts: 5
  retry_delay: 2
